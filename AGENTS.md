## Purpose

This file is for AI agents (and future maintainers) working on this repository. It summarizes **project structure**, **build/deploy setup**, and **theme/content conventions** so you can quickly make correct, safe changes.

## High-level Overview

- **Site type**: Hugo static site with **blogdown** integration for R/Markdown content.
- **Primary entrypoint**: Hugo config in `config/` (see below) and `index.Rmd` (blogdown site declaration).
- **Theme**: `hugo-clarity` (see `themes/hugo-clarity`).
- **Deployment**: Auto-deployed by **Netlify** on pushes to GitHub (see `netlify.toml`).

## Build & Deployment

- **Netlify config**: `netlify.toml`
  - **Build command**: `hugo`
  - **Publish directory**: `public`
 - **Hugo version**: `0.115.0` on Netlify (via `HUGO_VERSION` in `[build.environment]`)
  - **Branch deploy / deploy previews**: use `hugo -F -b $DEPLOY_PRIME_URL`
  - **Production env**: sets `HUGO_ENV = 'production'`
- **blogdown**:
  - `index.Rmd` contains:
    - `site: blogdown:::blogdown_site`
  - Content is authored via RStudio blogdown addins (see `README.md` for the human workflow).
  - RMarkdown files (`*.Rmd`) are present under `content/post/`, but are **ignored by Hugo** directly via `ignoreFiles` in `config.toml`; blogdown handles rendering.

### Local development hints

- Typical human workflow (from `README.md`):
  - Use **RStudio**: `Addins > New Post` to create content.
  - Use `Addins > Serve Site` to preview locally.
  - Commit and push to GitHub; Netlify takes over deployment.

## Configuration (`config.toml`)

This repo now uses Hugo’s **config directory** layout:

- **Shared config**: `config/_default/config.toml`
- **Development overrides**: `config/development/config.toml` (sets `baseurl = "http://localhost:1313/"`, disables analytics locally)
- **Production overrides**: `config/production/config.toml` (sets canonical `baseurl`, GA ID, etc.)

Key settings to know:

- **Base URL**:
  - Dev: `http://localhost:1313/`
  - Prod: `https://www.harlan.harris.name/`
- **Theme**: `theme = "hugo-clarity"`
- **Ignored files**: `ignoreFiles = ["\\.Rmd$", "\\.Rmarkdown$", "_cache$"]`
- **Permalinks**:
  - Posts: `/year/month/slug/` (e.g., `/2025/12/example-post/`)
- **Outputs**: `home = ["HTML", "RSS", "JSON"]` (JSON for search/autocomplete).
- **Author**: now provided via `params.author` for compatibility with newer Hugo (RSS templates can no longer rely on `.Site.Author`).
- **Markup**: configured under `[markup]` (Goldmark + Highlighting).

**When changing config**:
- Keep `theme = "hugo-clarity"` consistent unless you intentionally migrate themes.
- Be careful with `ignoreFiles`—removing `\\.Rmd$` may cause Hugo to treat source Rmds as pages.
 - If you are debugging local preview URLs, ensure you are using the **development** environment: `hugo server -D -e development`.

## Directory Layout (Top-level)

- **`config/`**: Hugo configuration directory (see above).
- **`netlify.toml`**: Netlify build/deploy configuration.
- **`index.Rmd`**: Declares blogdown site; minimal content, but important for RStudio/blogdown.
- **`blog.Rproj`**: RStudio project file (relevant for humans, not needed for Netlify).
- **`README.md`**: Human-facing instructions for adding posts and images.
- **`assets/`**:
  - `assets/sass/_override.sass`: Local SASS overrides, likely merged with the `hugo-clarity` SASS pipeline.
- **`static/`**:
  - `static/css/style_custom.css`: Custom CSS overrides for the theme.
  - `static/icons/`: Favicon and PWA icons.
  - `static/images/`: Header and inline images for posts/pages.
  - `static/post/`: Images and generated assets associated with blog posts.
- **`content/`**:
  - `about.md`, `consulting.md`, `publications.md`: Top-level pages.
  - `content/post/`: All blog posts (mix of `.Rmd`, `.md`, `.html` produced by blogdown).
- **`data/`**:
  - `FootMenu.toml`, `Menu.toml`, `Modules.toml`, `Formats.yaml`, `Strings.yaml`: Data files (mirroring structure from themes) for menus, formats, and localized strings; used by the theme/layouts.
- **`i18n/`**:
  - `en.toml`: English translations for strings used in templates.
- **`layouts/`**:
  - `layouts/shortcodes/blogdown/postref.html`: Shortcode used by blogdown for referencing posts (default blogdown shortcode).
- **`resources/_gen/`**:
  - Hugo’s generated resources (processed SASS, images, etc.). **Do not hand-edit**; can usually be regenerated by Hugo.
- **`themes/`**:
  - `themes/hugo-clarity/`: Active theme (layouts, assets, static files).
  - `themes/hugo-bootstrap-premium/`: Additional theme present but not currently selected in `config.toml`.

## Themes

- **Active theme**: `hugo-clarity`
  - Layouts under `themes/hugo-clarity/layouts/`:
    - `_default/baseof.html`, `single.html`, `list.html`, `index.json`, etc.
    - `partials/` for header, footer, sidebar, search, etc.
  - Assets under `themes/hugo-clarity/assets/`:
    - `js/` (search, code highlighting, etc.)
    - `sass/` (base, components, utils, variables, overrides).
  - Static assets under `themes/hugo-clarity/static/`:
    - `fonts/`, `icons/`, `images/`.
- **Legacy/alternate theme**: `hugo-bootstrap-premium`
  - Present but not referenced in `config.toml`.
  - Has its own `data/`, `layouts/`, and `static/` hierarchy.

**When modifying theme behavior**:
- Prefer **local overrides** over editing theme code directly:
  - Use `assets/sass/_override.sass` and/or `static/css/style_custom.css` for styling tweaks.
  - Use top-level `layouts/` to shadow theme templates if structural changes are needed.

### Hugo v0.152 compatibility notes (theme changes made)

This repo required a few updates to work with Hugo v0.152+:

- `resources.ToCSS` was replaced with `css.Sass` in `themes/hugo-clarity/layouts/_default/baseof.html`.
- `.Site.IsMultiLingual` was replaced with `hugo.IsMultilingual` in `themes/hugo-clarity/layouts/partials/header.html`.
- Disqus was disabled in `themes/hugo-clarity/layouts/partials/comments.html` (to avoid removed `.Site.DisqusShortname` usage).
- Old tweet embeds were migrated to the `x` shortcode in a handful of historical posts.
- The theme’s image render hooks (`layouts/partials/image.html` and `_default/_markup/render-image.html`) previously tried to parse a config file from disk to discover `contentDir/staticDir`; this breaks with Hugo’s config directory structure. We now assume the defaults (`content/` and `static/`) to keep rendering stable.
- `.Site.Author` usage was removed from `themes/hugo-clarity/layouts/_default/rss.xml` (new Hugo versions removed it); use `site.Params.author.*` instead.

## Content Conventions

- **Posts**:
  - Located under `content/post/`.
  - Authored primarily as `.Rmd` or `.md` via RStudio/blogdown.
  - blogdown renders posts to `.html` in the same directory, which Hugo serves.
  - URLs follow the permalink pattern `/year/month/slug/`.
- **Pages**:
  - `content/about.md`, `content/consulting.md`, `content/publications.md` are standalone pages.
- **Images**:
  - Header images: stored in `static/images/`.
  - Inline images:
    - Preferred as **page bundles** (image stored alongside the content file).
    - Insert using Hugo shortcode syntax, e.g. `{{< figure src="myimg.png" title="My Title" >}}`.

## Agent Guidelines for Future Changes

- **Before editing**:
  - Check `config.toml` for any settings that may affect your change (e.g., permalinks, taxonomies, `ignoreFiles`).
  - If altering styles, confirm whether the change belongs in `style_custom.css` vs. SASS overrides.
- **When adding content**:
  - Follow existing patterns in `content/post/` for front matter and file naming.
  - Do **not** remove `ignoreFiles` for `*.Rmd` unless you also adjust the blogdown workflow.
- **When modifying themes/layouts**:
  - Prefer creating/using top-level `layouts/` to override theme templates.
  - Be careful with partials, as they may be reused across many pages.
- **When touching generated files**:
  - Avoid editing anything under `resources/_gen/`—these are build artifacts.

## Quick Start Checklist for Agents

1. **Need to add a new page/post layout?**
   - Copy an appropriate layout from `themes/hugo-clarity/layouts/` into `layouts/` and modify it there.
2. **Need to tweak styles?**
   - Use `static/css/style_custom.css` or `assets/sass/_override.sass`.
3. **Need to adjust navigation or social links?**
   - Edit `config.toml` menus (`[[menu.main]]`, `[[menu.social]]`) or `data/Menu.toml` / `data/FootMenu.toml` depending on where the change belongs.
4. **Need to debug deployment issues?**
   - Confirm `netlify.toml` build command and environment (Hugo version, `HUGO_ENV`).
   - Ensure `public/` contains the generated site after a local `hugo` build (if running locally).


